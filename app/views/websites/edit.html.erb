<div class="builder-wrapper">
  <%= render 'tooltips/tooltip_navigate' %>
  <%#= render 'tooltips/tooltip_welcome' %>
  <div class="loader-container">
    <div class="loader"></div>
  </div>
  <div class="builder-website">
    <%= render "templates/#{@website.template.slug}" %>
  </div>
  <%= render 'shared/panel' %>
  <%= render 'shared/toolbar' %>
</div>

<% content_for(:after_js) do %>
  <script>
    var toolbarItems = document.querySelectorAll('.toolbar li');
    var activeClass = 'toolbar-menu-item-active';
    var urlBox = document.getElementById('website_url');
    var submitButton = document.querySelector('#website-submit');

    $(document).ready(function(){
      $('.website_template_id input').change(function(e) {

        // Show loader
        var loader = document.querySelector('.loader-container');
        loader.style.display = 'flex';
        var template = $(this).data('template');
        var url = "/websites/<%= @website.id %>/template";
        $.ajax({
          url: url,
          dataType: "json",
          data: { template_slug: template },
          success: function(data) {
            $('.builder-website').html(data.html);
            loader.style.display = 'none';
          }
        });
      });
    });

  submitButton.addEventListener('click', function() {
    if ((toolbarItems[2].classList.contains(activeClass))&&(urlBox.value !== "")) {
      // Redirect to the current user website
      // window.open('<%= "#{root_url}#{@website.url}" %>')
      window.open(`<%= root_url %>${urlBox.value}`)
      }
  });

  </script>
<% end %>
